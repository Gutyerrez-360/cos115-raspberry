<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Raspberry</title>
    <link
      rel="stylesheet"
      href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    />
    <link rel="stylesheet" href="https://drive.google.com/uc?export=download&id=1s322Od1n1hB0OY4GARpMXJIqfYdmgxbV" />
  </head>
  <body>
    <nav class="navbar navbar-expand-md navbar-dark">
        <div class="container">
          <div class="navbar-header">
            <img class="image" src="https://drive.google.com/uc?export=download&id=1JSeeSMTju8YRejeFpBrxqrZtZpFIHlYH" alt="logo" width="50px" height="25px">
          </div>
          <div class="navbar-header text-center">
            <a class="navbar-brand" href="./index.html">COS115-GRUPO-10-CICLO-2-2023</a>
          </div>
          <button
            class="navbar-toggler"
            type="button"
            data-toggle="collapse"
            data-target="#navbarNav"
            aria-controls="navbarNav"
            aria-expanded="false"
            aria-label="Toggle navigation"
          >
            <span class="navbar-toggler-icon"></span>
          </button>
      
          <div class="collapse navbar-collapse" id="navbarNav">
            <ul class="navbar-nav ml-auto">
              <li class="nav-item active">
                <li class="nav-link"></li>
              </li>
              <li class="nav-item">
                <li class="nav-link"></li>
              </li>
              <li class="nav-item">
                <li class="nav-link"></li>
              </li>
              <li class="nav-item">
                <li class="nav-link"></li>
              </li>
            </ul>
          </div>

        </div>
      </nav>
    
    <div class="container">
      <div class="border-container">
        <br />
        <h2>¿Cómo configurar una Raspberry Pi v4 como router ?</h2>
        <h3>Objetivo</h3>
        <p>
          Configurar el hardware Raspberry Pi 4, como un router físico, basado en Dynamips + IOS Cisco. De tal manera que a través de dos interfaces físicas ethernet se pueda llevar a cabo la tarea de enrutamiento con la imagen de IOS elegida (en nuestro caso la imagen del router c3725), como si fuese un router físico. El equipo deberá disponer de accesos de configuración via ssh y telnet. Al inyectarle energía eléctrica, el dispositivo deberá de arrancar, con una dirección IP estática, en la interfaz de red empotrada del Raspberry, a la cual se deberá poder conectar a través de SSH o Telnet para iniciar la configuración, de las diferentes opciones que disponga la imagen utilizada.
        </p>
        <h3>Descripción</h3>
        <p>
          Los equipos deberán implementar una topología de red física, para demostrar el funcionamiento del prototipo. Deberá tener a consideración aspectos relacionados a la velocidad de acceso y rendimiento del prototipo diseñado. La topología de demostración deberá brindar acceso a Internet a través de la red en la cual se esté haciendo la defensa. Será considerado la velocidad del acceso, el equipo deberá de tomar a consideración dichos parámetros para poder brindar un acceso de calidad al momento de la defensa.
        </p>
        <h3>Topología</h3>
        <img src="https://drive.google.com/uc?export=download&id=1LUMHozR19rn8drIXTeN8rlCtEjeZQ0kl" alt="raspberry-pi-imager" width="80%">
        <br><br>
        <table class="table table-dark table-striped">
          <thead>
            <th>Integrantes</th>
            <th>Carné</th>
          </thead>
          <tbody>
            <tr>
              <td>Misael Antonio Gómez García</td>
              <td>GG20031</td>
            </tr>
            <tr>
              <td>Juan Manuel Gutiérrez Escobar</td>
              <td>GE19020</td>
            </tr>
            <tr>
              <td>Fabio Ernesto Flores Mendoza</td>
              <td>FM19038</td>
            </tr>
            <tr>
              <td>Manuel Alejandro Rico Rodríguez</td>
              <td>RR20044</td>
            </tr>
          </tbody>
        </table>
        <h2>Instalación del Sistema Operativo en la Raspberry Pi</h2>
        <p>
          Al igual que en una computadora de escritorio necesitamos un disco duro para instalar nuestro Sistema Operativo
          en este caso usaremos una Micro SD como nuestro disco duro y Raspberry Pi Imager como nuestro software quemador de disco.
        </p>

        <h3>Paso 1: Descargar e instalar Raspberry Pi Imager</h3>
        <ol>
          <li>
            Ve al sitio web oficial de Raspberry Pi Imager: <a href="https://www.raspberrypi.org/software/" target="_blank">Raspberry Pi Downloads</a>.
            
          </li>
          
          <li>
            Descarga la versión adecuada para tu sistema operativo (Windows, macOS, Linux).
            <img src="https://drive.google.com/uc?export=download&id=1zO6M7EkwwMlTDpoDfpXQZH402FHjBDnn" alt="raspberry-pi-imager" width="80%">
          </li>

          <li>Instala la aplicación siguiendo las instrucciones proporcionadas.</li>

        </ol>

        <br>

        <h3>Paso 2: Insertar la tarjeta SD en tu computadora</h3>
        <ol>
          <li>Utiliza un lector de tarjetas SD para insertar la tarjeta en tu computadora.</li>
        </ol>
        <img src="https://drive.google.com/uc?export=download&id=1Z_2IdYw5URTWSXZTstkQqt72RnXUI87M" alrt="sd" width="50%">

        <br>

        <h3>Paso 3: Abrir Raspberry Pi Imager y seleccionar el sistema operativo</h3>

        <ol>
          <li>
            Abre Raspberry Pi Imager.
            <br>
            <img src="https://drive.google.com/uc?export=download&id=1ZUEAxniB9CxyjMd3lGxPjXa6NNlyePY9" alt="pi-imager-home" width="50%">
          </li>
          <li>
            Puedes elegir entre varias opciones, como Raspbian (ahora llamado Raspberry Pi OS), Ubuntu, o cualquier otro sistema operativo compatible en este caso usamos una imagen especifica. Haz clic en "Choose OS" y selecciona "Use custom".
            <img src="https://drive.google.com/uc?export=download&id=1mmBC4dRvQh67x4Rddx7hlubdqIe4jS7f" alt="select-os" width="80%">
            <img src="https://drive.google.com/uc?export=download&id=1ETq5-S_FqCgXmb2k-_BIMKfRpjpAjHTe" alt="select-os" width="80%">
          </li>

        </ol>

        <h3>Paso 4: Seleccionar la tarjeta SD</h3>
        <ol>
          <li>Haz clic en "Choose Storage" y selecciona la tarjeta SD que has insertado.</li>
          <img src="https://drive.google.com/uc?export=download&id=1XVemU7ad-ohQi967oVwhKnsC8bVk3PDv" alt="select-os" width="80%">
          <img src="https://drive.google.com/uc?export=download&id=15_g6eq7mZzCYjcibagtReS9eWzlILZhH" alt="select-os" width="80%">
        </ol>
        
        <h3>Paso 5: Habilitar SSH</h3>
        <ol>
          <li>Haz clic en "El engranaje" y configura el ssh.</li>
          <img src="https://drive.google.com/uc?export=download&id=1UCsW0JIc0jPNfTthQH1z6kTYLD85otVe" alt="select-os" width="80%">
          <img src="https://drive.google.com/uc?export=download&id=10_U6y2BEsMDe728LNFNHNjnOnb758v0i" alt="select-os" width="80%">
        </ol>

        <h3>Paso 6: Instalar el sistema operativo</h3>
        <ol>
          <li>Haz clic en "Write" para comenzar el proceso de escritura en la tarjeta SD.</li>
          
          <img src="https://drive.google.com/uc?export=download&id=1SfyvG1cTM9T-iMZcM7_O6Kq9IjlpJiEx" alt="select-os" width="80%">
          <li>Raspberry Pi Imager descargará la imagen del sistema operativo y la instalará en la tarjeta SD.
          </li>
        </ol>

        <h3>Paso 7: Retirar la tarjeta SD</h3>
        <ol>
          <li>Una vez completada la instalación, retira con seguridad la tarjeta SD de tu computadora.</li>
        </ol>

        <h3>Paso 8: Iniciar la Raspberry Pi</h3>
        <ol>
          <li>Inserta la tarjeta SD en tu Raspberry Pi.</li>
          <li>Conecta la Raspberry Pi a la corriente por medio cable USB-C y conecta un cable LAN de tu router al Raspberry Pi.</li>
        </ol>
        
        <h2>Acesso Remoto</h2>
        <ol>
          <li>Via SSH <strong>ssh pi@raspberrypi ó ssh pi@ip_raspberry</strong></li>
          <li>Via Telnet <strong>telnet ip_raspberry port</strong></li>
        </ol>

        <h2>Configuración IP Estática</h2>
        <p>Para evitar que la ip de la Raspberry cambie cada vez que se reinicie nuestra conexión local a internet,
          accedemos via remota por cualquiera de los metodos antes mencionados y ejecutamos
          los siguiente comandos en la terminal:
        </p>

        <ol>
          <li><strong>sudo nano /etc/dhcpcd.conf</strong></li>
          <p>
            Veremos en el terminal un archivo de texto con una lineas comentadas que inician con #
            <div class="code-background">
              <pre><code class="">
                #interface eth0
                #static ip_address=192.168.0.8/24
                #static routers=192.168.0.1
                #static domain_name_servers=192.168.0.1 8.8.8.8   
              </code></pre>
            </div>
            
            
            Ahora borraremos el '#'
  
            <div class="code-background">
              <pre><code>
                interface eth0
                static ip_address=192.168.0.8/24
                static routers=192.168.0.1
                static domain_name_servers=192.168.0.1 8.8.8.8
              </code></pre>
            </div>
          </p>
        </ol>
        <h2>Instalar Dynamips</h2>
        <ol>
          <li>
            Instalar git: <strong>sudo apt-get install git</strong><br>
            <img src="https://drive.google.com/uc?export=download&id=1UMEgTNosStpvJjV0eCJbJlG3aUQ6BgDs"
            width="80%" alt="instalando-git">
          </li>
          <br>
          <li>
            Clonar Repositorio Dynamips con: <strong>git clone https://github.com/GNS3/dynamips.git</strong><br>
            <img src="https://drive.google.com/uc?export=download&id=1u1eLsAJgADPYaU4k3y1NlSrwYANMptDn" 
            width="80%" alt="clone-dynamips">
          </li>
          <br>
          <li>
            Instalar Cmake con el siguiente comando: <strong>sudo apt-get install cmake</strong> <br>
            <img src="https://drive.google.com/uc?export=download&id=1OX52KNnW9lGMxnadmUn8RvkC6fiJUXDE" 
            width="80%" alt="install-cmake">
          </li>
          <br>
          <li>
            Instalar Dependencias: <strong>sudo apt-get install build-essential libelf-dev uuid-dev libpcap-dev</strong>
            <br>
            <img src="https://drive.google.com/uc?export=download&id=1n2oQLzlMlgPuxyX4_pWIrddIfujZwoXR" 
            width="80%" class="cmake-dependencias">
          </li>
          <br>
          <li>Acceder al dynamips y crear la carpeta Build
             <img src="https://drive.google.com/uc?export=download&id=1k5sAizd6F6zGwgoatj3EAEYENrE-7bK-" 
            width="80%" class="cmake-dependencias">
          </li>
          
          <li>
            Ejecutar: <strong>sudo cmake ..</strong>
          </li>
          <li>
            Ejecutar: <strong>sudo make</strong>
          </li>
          <li>
            Ejecutar: <strong>sudo make install</strong><br>
            <img src="https://drive.google.com/uc?export=download&id=1KBR8is3tSTtfilP8VVi0DAY0iK8-iMFv" 
            width="80%" alt="sudo-make-install">
          </li>
        </ol>
        <h2>Instalar Dynagen</h2>
        <p>
          Para descargar e instalar Dynagen debemos descargar el instalador con extensión .rpm y convertirlo a 
          a .deb con la ayuda de la herramienta alien.
        </p>
      
        <ol>
          <li>Descargar .rpm desde el siguiente enlace <a href="https://sourceforge.net/projects/dyna-gen/files/dynagen%20source%20_%20Linux/dynagen%200.11.0/dynagen-0.11.0-1.fc9.noarch.rpm/download">Enlace de Descarga</a></li>
          <li>
            Si no posee una interfaz gráfica su raspberyPi porque usara la consola, utilice el comando: wget url_de_descarga, puede descargarlo en cualquier ubicación, solo debe recordar en donde se encuentra, PARA NUESTRO CASO SE USO LA CARPETA Downloads asi que ingresamos a ella con cd Downloads.
            <img src="https://drive.google.com/uc?export=download&id=1N0XKea_bM8tOHmwPDHREGvUZdO5mo9m3" 
            width="80%" alt="sudo-make-install">
          </li>
          <li>
            Si el comando Dynagen no funciona, verifique la versión de Python si es mayor a 3, hay que purgar esa versión e instalar la versión de python2
            <img src="https://drive.google.com/uc?export=download&id=117Vf9HxUvdtLLej5RFvJXVnE33Rtr24G" 
            width="80%" alt="sudo-make-install">
          </li>
          <li>Instalar Alien con el siguiente comando: <strong>sudo apt-get install alien</strong></li>
          <li>Convertir .rpm a .deb: <strong>alien --to-deb --keep-version dynagen-0.11.0-1.fc9.noarch.rpm</strong></li>
          <li>Instalar Dynagen: <strong>dpkg --install dynagen_0.11.0-1.fc9_all.deb</strong></li>
        </ol>

        <h2>Configuración router</h2>
        <ol>
          <li>Crear dos carpetas en /pi: routerConfig y routerImage. Usamos <strong>mkdir routerConfig routerImage</strong></li>
          <li>Descargar imagen del router c3725, en este caso utilizamos la imagen proporcionada por la cátedra para las 
            prácticas de Laboratorio.
          </li>
          <li>Copiar la imagen del router c3725 a la carpeta routerImage</li>
          <li>
            debido a que no teníamos una url directa para la descarga, usamos una trasnferencia de archivo desde Windows hacia RaspberryPi OS usando el comando ( scp archivo.bin pi@ip_raspberry: /home/pi )<br>
            Ejemplo ruta donde esta nuestro .bin en Windows usuario e ip de destino y ruta de destino
            <br>
            <img src="https://drive.google.com/uc?export=download&id=1HOxGQcxz6Btd3rcXbcsOpzxDwQN5UnKA" 
            width="80%" alt="sudo-make-install">
          </li>
          <li>Crear un archivo de texto llamado "router.net" dentro de la carpeta routerConfig</li>
          <li>Para crear el archivo ejecutamos <strong>nano router.net</strong> y copiamos lo siguiente.</li>
          <img src="https://drive.google.com/uc?export=download&id=1q0r75T99ZJfmp94-z1C-8xJ8C60-x-WU" 
            width="80%" alt="sudo-make-install">
        </ol>

        <h2>Conexión manual</h2>
        <ol>
          <li>
            Iniciar dynamips: sudo dynamips -H 7200 &
            <div class="code-background">
              <pre><code>
                sudo dynamips -H 7200 &
              </code></pre>
            </div>
          
        </li>
          <li>
            Para que el comando telnet 127.0.0.1 7000 funcione en configuración manual hay que decirle a telnet que el puerto 7000 esta listo para arrancar de la siguiente forma
            <img src="https://drive.google.com/uc?export=download&id=1gICzUMftzlG7rPOcj8y0bJDZb86Ttpf0" 
            width="80%" alt="sudo-make-install">
          </li>
        <li>
          Abrir otra terminal y iniciar dynagen con la configuración del archivo router.net
          <div class="code-background">
            <pre><code>
              sudo dynagen /home/pi/routerConfig/router.net
            </code></pre>
          </div>
        
      </li>
      <li>
        Abrir otra terminal y conectarse al router. Para poder hacer las configuraciones al router desde la consola  propia del router ingresamos el siguiente comando
        <div class="code-background">
          <pre><code>
            telnet 127.0.0.1 7000
          </code></pre>
        </div>
      
    </li>
        </ol>
      
      <h2>Configuración de Arranque automático.</h2>
      <p>Para que el router Inicie de manera automática debemos agregar las siguientes configuraciones</p>
      <div class="code-background">
        <pre><code>
          sudo crontab -e
        </code></pre>
      </div>
      <br>
      <div class="code-background">
        <pre><code>
          @reboot sudo dynamips -H 7200 &
          @reboot sudo /usr/bin/dynagen /home/pi/routerConfig/router.net
        </code></pre>
      </div>
      
      <img src="https://drive.google.com/uc?export=download&id=1F6PummDXA1Dgdt-NzKzWpH5e1DNP_3NJ" 
            width="80%" alt="sudo-make-install">

      <p>
        Al modificar el archivo crontab ya no será necesario iniciar manualmente el router, Al encender la Raspberry el router iniciará automáticamente y la computadora conectada tendrá acceso a internet y a la red.
        Finalmente nuestra Raspberry está funcionando como un router físico el cual podemos configurar para utilizarlo en nuestra topología.
        Para entrar a la configuración del router, se debe ejecutar el comando ena, el cual es un acronimo del comando completo enable.
        Una vez dentro del modo con privilegios exec, se realizaran las configuraciones del router.
        En este caso usaremos dhcp pool LAN, con ello buscamos que los dispositivos que se conecten reciban automáticamente la configuración DHCP para poder tener la conexión a internet. La configuración es la siguiente:
      </p>

      <div class="code-background"><pre><code>
        interface f0/0
        ip address dhcp 
        ip nat outside 
        no shutdown  
        exit 

        interface f0/1
        ip address 10.82.0.1 255.255.255.0
        ip nat inside
        no shutdown  
        exit 

        /*Definiendo las lista de acceso, donde se permitira Nat*/
        access­-list 100 permit ip 10.82.0.0 0.0.0.255 any
        ip nat inside source list 100  interface f0/0 
        exit

        /*Definiendo el pool que permitira la configuracion DHCP*/
        ip dhcp pool Red
        /*Definicion completa de la red para el dhcp*/
        network 10.82.0.0 255.255.255.0
        */gateway/puerta de enlace que obtendrá la pc por dhcp/* 
        default­-router 10.82.0.1 
        lease 1
        */Servidor dns para la traduccion de dominios que obtendra por dhcp/* 
        dns-­server 8.8.8.8 
        exit
        */Se excluye de la conf. dhcp la ip del primer host (f0/1)/*
        ip dhcp excluded-­address 10.82.0.1
        */Se excluye de la conf. dhcp la ip de broadcast /*
        ip dhcp excluded-­address 10.82.0.255
        end 
      </code></pre></div>
      <h2>Resultados</h2>
      <p>Finalmente nuestro Router ha sido completamente configurado y listo para su implementación.</p>
      <center><img src="https://drive.google.com/uc?export=download&id=1tDMKOT4DcpclOnOMCdJDarHKl1t8wRYq" alt="r1" height="600px" width="600px">
        <br>
        <br>
        <img src="https://drive.google.com/uc?export=download&id=10l8NmrLtmA4jqSnLALReSLMvsZjPEyeQ" alt="r2" height="600px" width="600px">
        <br>
        <br>
        <img src="https://drive.google.com/uc?export=download&id=1Woe4xdGBsGgbMhTNJ53b-bpTf3CLJ-gl" alt="r3" height="600px" width="600px">
        <h3>Configuración de Red PC1.</h3>
        <img src="https://drive.google.com/uc?export=download&id=1RgX2iLjOrYCUCsCt95KcWGDCTc8QOr89" alt="pc_a_router" height="800px" width="800px">
        
        
   </center>
      </div>
    </div>

    <footer>
      <div class="container text-center">
        <p>© 2023 Grupo COS115 FIA UES Todos los derechos reservados.</p>
        <p>
          <a href="#">Política de Privacidad</a> |
          <a href="#">Términos y Condiciones</a>
        </p>
      </div>
    </footer>
    <script src="https://drive.google.com/uc?export=download&id=1vrJiE7b27Q82Efi7vKNlxu0C2hG6Wqz4"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.5.4/dist/umd/popper.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
  </body>
</html>